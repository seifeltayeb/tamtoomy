<script>
    async function fetchTime() {
        try {
            const response = await fetch('/get_time');
            const data = await response.json();
            document.getElementById("days").textContent = data.days;
            document.getElementById("hours").textContent = data.hours;
            document.getElementById("minutes").textContent = data.minutes;
        } catch (error) {
            console.error("Error fetching time:", error);
        }
    }

    async function checkForNotifications() {
        try {
            const response = await fetch('/notify');
            const data = await response.json();
            if (data.message && "Notification" in window && Notification.permission === "granted") {
                new Notification(data.message);
            }
        } catch (error) {
            console.error("Error fetching notifications:", error);
        }
    }

    function requestNotificationPermission() {
        if ("Notification" in window) {
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    console.log("Notifications enabled");
                }
            });
        }
    }

    requestNotificationPermission();
    setInterval(fetchTime, 60000);  // Update countdown every minute
    setInterval(checkForNotifications, 60000);  // Check for notifications every minute
    fetchTime();  // Initial fetch
</script>
